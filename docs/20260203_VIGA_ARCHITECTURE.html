<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VIGA Architecture - SAM3D & TRELLIS</title>
    <style>
        :root {
            --bg-primary: #0d1117;
            --bg-secondary: #161b22;
            --bg-tertiary: #21262d;
            --text-primary: #e6edf3;
            --text-secondary: #8b949e;
            --accent-blue: #58a6ff;
            --accent-green: #3fb950;
            --accent-purple: #a371f7;
            --accent-orange: #d29922;
            --border-color: #30363d;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Noto Sans', Helvetica, Arial, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.6;
            padding: 2rem;
        }
        
        .container {
            max-width: 1000px;
            margin: 0 auto;
        }
        
        h1 {
            font-size: 2rem;
            margin-bottom: 0.5rem;
            color: var(--accent-blue);
        }
        
        .subtitle {
            color: var(--text-secondary);
            margin-bottom: 2rem;
        }
        
        .section {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }
        
        h2 {
            font-size: 1.3rem;
            margin-bottom: 1rem;
            color: var(--accent-green);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        h3 {
            font-size: 1.1rem;
            margin: 1rem 0 0.5rem 0;
            color: var(--accent-purple);
        }
        
        /* Architecture Diagram */
        .architecture {
            display: flex;
            flex-direction: column;
            gap: 0;
            margin: 1.5rem 0;
        }
        
        .arch-layer {
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        
        .arch-box {
            padding: 1rem 1.5rem;
            border-radius: 8px;
            font-weight: 600;
            min-width: 200px;
            text-align: center;
        }
        
        .arch-viga {
            background: linear-gradient(135deg, #238636, #2ea043);
            font-size: 1.2rem;
        }
        
        .arch-sam3d {
            background: linear-gradient(135deg, #1f6feb, #388bfd);
            margin-left: 2rem;
        }
        
        .arch-trellis {
            background: linear-gradient(135deg, #8957e5, #a371f7);
            margin-left: 4rem;
        }
        
        .arch-arrow {
            color: var(--text-secondary);
            font-size: 1.5rem;
            margin-left: 3rem;
            padding: 0.5rem 0;
        }
        
        .arch-desc {
            color: var(--text-secondary);
            font-size: 0.9rem;
            margin-left: 1rem;
        }
        
        /* Component Details */
        .component-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }
        
        .component-card {
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            padding: 1rem;
        }
        
        .component-card h4 {
            color: var(--accent-blue);
            margin-bottom: 0.5rem;
            font-size: 1rem;
        }
        
        .component-card p {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }
        
        .component-card ul {
            margin-top: 0.5rem;
            padding-left: 1.2rem;
            color: var(--text-secondary);
            font-size: 0.85rem;
        }
        
        .component-card li {
            margin: 0.3rem 0;
        }
        
        /* TRELLIS Pipeline */
        .pipeline {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            flex-wrap: wrap;
            margin: 1rem 0;
            padding: 1rem;
            background: var(--bg-tertiary);
            border-radius: 6px;
        }
        
        .pipeline-step {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            padding: 0.5rem 1rem;
            border-radius: 4px;
            font-size: 0.85rem;
        }
        
        .pipeline-arrow {
            color: var(--accent-orange);
            font-weight: bold;
        }
        
        /* Code blocks */
        code {
            background: var(--bg-tertiary);
            padding: 0.2rem 0.4rem;
            border-radius: 4px;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 0.9rem;
            color: var(--accent-orange);
        }
        
        pre {
            background: var(--bg-tertiary);
            padding: 1rem;
            border-radius: 6px;
            overflow-x: auto;
            font-size: 0.85rem;
            margin: 1rem 0;
        }
        
        pre code {
            background: none;
            padding: 0;
        }
        
        /* Table */
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 1rem 0;
        }
        
        th, td {
            border: 1px solid var(--border-color);
            padding: 0.75rem;
            text-align: left;
        }
        
        th {
            background: var(--bg-tertiary);
            color: var(--accent-blue);
        }
        
        tr:hover {
            background: var(--bg-tertiary);
        }
        
        /* Info box */
        .info-box {
            background: rgba(56, 139, 253, 0.1);
            border-left: 4px solid var(--accent-blue);
            padding: 1rem;
            border-radius: 0 6px 6px 0;
            margin: 1rem 0;
        }
        
        .info-box.warning {
            background: rgba(210, 153, 34, 0.1);
            border-left-color: var(--accent-orange);
        }
        
        .timestamp {
            color: var(--text-secondary);
            font-size: 0.85rem;
            margin-top: 2rem;
            padding-top: 1rem;
            border-top: 1px solid var(--border-color);
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üèóÔ∏è VIGA Architecture</h1>
        <p class="subtitle">Hierarchical relationship between VIGA, SAM3D, and TRELLIS</p>
        
        <div class="section">
            <h2>üìê Architecture Hierarchy</h2>
            
            <div class="architecture">
                <div class="arch-layer">
                    <div class="arch-box arch-viga">üé¨ VIGA</div>
                    <span class="arch-desc">Your complete project: Video ‚Üí 3D reconstruction pipeline</span>
                </div>
                <div class="arch-arrow">‚Üì</div>
                <div class="arch-layer">
                    <div class="arch-box arch-sam3d">üéØ SAM3D</div>
                    <span class="arch-desc">Single-image to 3D tool (core module of VIGA)</span>
                </div>
                <div class="arch-arrow">‚Üì</div>
                <div class="arch-layer">
                    <div class="arch-box arch-trellis">üß† TRELLIS</div>
                    <span class="arch-desc">Microsoft's 3D generation model architecture (underlying engine)</span>
                </div>
            </div>
            
            <div class="info-box">
                <strong>Simple analogy:</strong><br>
                VIGA is your car, SAM3D is the engine, TRELLIS is the core technology inside the engine.
            </div>
        </div>
        
        <div class="section">
            <h2>üîß Component Details</h2>
            
            <div class="component-grid">
                <div class="component-card">
                    <h4>üé¨ VIGA (Video-to-3D Gaussian Avatar)</h4>
                    <p>Your complete workflow, including:</p>
                    <ul>
                        <li>Video input & frame extraction</li>
                        <li>SAM2 object segmentation</li>
                        <li>SAM3D 3D reconstruction</li>
                        <li>Scene composition & export</li>
                    </ul>
                </div>
                
                <div class="component-card">
                    <h4>üéØ SAM3D (Segment Anything Model 3D)</h4>
                    <p>VIGA's 3D reconstruction module:</p>
                    <ul>
                        <li>Input: RGB image + Mask</li>
                        <li>Output: GLB/PLY 3D model</li>
                        <li>Uses TRELLIS architecture underneath</li>
                    </ul>
                </div>
                
                <div class="component-card">
                    <h4>üß† TRELLIS (Microsoft)</h4>
                    <p>SAM3D's neural network engine:</p>
                    <ul>
                        <li>Sparse Structure sampling</li>
                        <li>Sparse Latent representation</li>
                        <li>Dual decoder architecture (GS + Mesh)</li>
                    </ul>
                </div>
            </div>
        </div>
        
        <div class="section">
            <h2>‚öôÔ∏è TRELLIS Inference Pipeline</h2>
            <p>Internal flow when SAM3D invokes TRELLIS:</p>
            
            <div class="pipeline">
                <div class="pipeline-step">üì∑ Image + Mask</div>
                <span class="pipeline-arrow">‚Üí</span>
                <div class="pipeline-step">üî≤ Condition Embedder</div>
                <span class="pipeline-arrow">‚Üí</span>
                <div class="pipeline-step">üì¶ Sparse Structure</div>
                <span class="pipeline-arrow">‚Üí</span>
                <div class="pipeline-step">üßä Sparse Latent</div>
                <span class="pipeline-arrow">‚Üí</span>
                <div class="pipeline-step">üîÄ Dual Decoder</div>
            </div>
            
            <h3>Dual Decoder Architecture</h3>
            <table>
                <tr>
                    <th>Decoder</th>
                    <th>Output</th>
                    <th>Purpose</th>
                </tr>
                <tr>
                    <td><code>slat_decoder_gs</code></td>
                    <td>Gaussian Splatting</td>
                    <td>Color & texture information</td>
                </tr>
                <tr>
                    <td><code>slat_decoder_mesh</code></td>
                    <td>Mesh geometry</td>
                    <td>Vertex & face structure</td>
                </tr>
            </table>
            
            <p style="margin-top: 1rem;">Both decoders run <strong>in parallel</strong>, then merge: Mesh provides geometry, GS provides vertex colors ‚Üí export as GLB.</p>
        </div>
        
        <div class="section">
            <h2>üìÅ Code Path Mapping</h2>
            
            <pre><code>GenesisVIGA/
‚îú‚îÄ‚îÄ tools/
‚îÇ   ‚îî‚îÄ‚îÄ sam3d/
‚îÇ       ‚îî‚îÄ‚îÄ sam3d_worker.py          # VIGA entry point
‚îÇ
‚îî‚îÄ‚îÄ utils/third_party/sam3d/
    ‚îî‚îÄ‚îÄ sam3d_objects/
        ‚îú‚îÄ‚îÄ pipeline/
        ‚îÇ   ‚îî‚îÄ‚îÄ inference_pipeline.py # TRELLIS inference flow
        ‚îÇ
        ‚îî‚îÄ‚îÄ models/
            ‚îú‚îÄ‚îÄ sparse_structure/     # Sparse structure model
            ‚îú‚îÄ‚îÄ structured_latent/    # Sparse latent model
            ‚îî‚îÄ‚îÄ slat_decoder_*/       # Dual decoders</code></pre>
        </div>
        
        <div class="section">
            <h2>üíæ VRAM Usage Distribution</h2>
            
            <table>
                <tr>
                    <th>Stage</th>
                    <th>TRELLIS Component</th>
                    <th>VRAM Usage</th>
                    <th>Duration</th>
                </tr>
                <tr>
                    <td>Model Loading</td>
                    <td>All models</td>
                    <td>~4-6 GB</td>
                    <td>~20-30s</td>
                </tr>
                <tr>
                    <td>Stage 1</td>
                    <td><code>sparse_structure_sampler</code></td>
                    <td>+2-4 GB</td>
                    <td>~10-60s</td>
                </tr>
                <tr>
                    <td>Stage 2</td>
                    <td><code>slat_sampler</code></td>
                    <td>+2-3 GB</td>
                    <td>~15-80s</td>
                </tr>
                <tr>
                    <td>Stage 3</td>
                    <td><code>slat_decoder_*</code></td>
                    <td>+4-6 GB (peak)</td>
                    <td>~1-7min</td>
                </tr>
            </table>
            
            <div class="info-box warning">
                <strong>‚ö†Ô∏è OOM typically occurs in Stage 3 (Decode)</strong><br>
                This is the peak VRAM stage. A 3200√ó2082 image on RTX 5080 (16GB) peaked at ~14.9GB.
            </div>
        </div>
        
        <div class="section">
            <h2>üîß VRAM Optimization Configs</h2>
            <p>Pre-configured pipeline variants for different VRAM budgets:</p>
            
            <table>
                <tr>
                    <th>Config File</th>
                    <th>num_gaussians</th>
                    <th>Point Count</th>
                    <th>VRAM</th>
                </tr>
                <tr>
                    <td><code>pipeline.yaml</code></td>
                    <td>32</td>
                    <td>100%</td>
                    <td>High (default)</td>
                </tr>
                <tr>
                    <td><code>pipeline_midvram.yaml</code></td>
                    <td>16</td>
                    <td>50%</td>
                    <td>Medium</td>
                </tr>
                <tr>
                    <td><code>pipeline_lowvram.yaml</code></td>
                    <td>8</td>
                    <td>25%</td>
                    <td>Low</td>
                </tr>
            </table>
            
            <h3>Usage</h3>
            <pre><code># Low VRAM mode
python sam3d_worker.py --config ".../pipeline_lowvram.yaml" ...

# Medium VRAM mode
python sam3d_worker.py --config ".../pipeline_midvram.yaml" ...</code></pre>
        </div>
        
        <div class="section">
            <h2>üîó Related Documentation</h2>
            <ul>
                <li><a href="20260203_SAM3D_BOTTLE_TEST.html" style="color: var(--accent-blue);">SAM3D Bottle Test Report</a></li>
                <li><a href="20260201_SAM3D_WSL_TESTING.html" style="color: var(--accent-blue);">SAM3D WSL Testing Notes</a></li>
                <li><a href="https://github.com/microsoft/TRELLIS" style="color: var(--accent-blue);" target="_blank">TRELLIS GitHub (Microsoft)</a></li>
            </ul>
        </div>
        
        <p class="timestamp">
            üìÖ Created: 2026-02-03 15:05 PST<br>
            üìÖ Updated: 2026-02-03 15:24 PST<br>
            ü§ñ Author: Yuna
        </p>
    </div>
</body>
</html>
<!-- Created by Yuna -->